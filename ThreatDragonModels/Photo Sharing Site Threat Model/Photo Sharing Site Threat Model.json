{
  "$schema": "https://threatdragon.org/schema/v2.5.0/tm.json",
  "title": "Photo-Sharing Site - Context Diagram",
  "owner": "Security Team",
  "description": "High-level DFD for photo upload and retrieval functions. Network assets are out of scope per instructions.",
  "diagram": {
    "name": "Level 1 - System Context",
    "diagramType": "DFD",
    "elements": [
      // ===== EXTERNAL ENTITIES =====
      {
        "name": "User",
        "type": "entity",
        "description": "An end-user of the photo-sharing service.",
        "position": {"x": 100, "y": 300}
      },
      {
        "name": "Payment Processor",
        "type": "entity",
        "description": "External system handling billing (Out of Scope).",
        "position": {"x": 1100, "y": 100}
      },

      // ===== PROCESSES =====
      {
        "name": "Web Application",
        "type": "process",
        "description": "The main application handling user interactions, authentication, and business logic for photos.",
        "position": {"x": 500, "y": 300}
      },

      // ===== DATA STORES =====
      {
        "name": "User Database",
        "type": "dataStore",
        "description": "Stores user credentials, metadata, and profile information.",
        "position": {"x": 500, "y": 100}
      },
      {
        "name": "Photo Storage",
        "type": "dataStore",
        "description": "Stores the actual image files uploaded by users.",
        "position": {"x": 500, "y": 500}
      },

      // ===== DATA FLOWS =====
      // Flows between User and Web Application
      {
        "name": "Login Credentials",
        "type": "flow",
        "description": "User sends username and password (over HTTPS).",
        "source": "User",
        "destination": "Web Application",
        "position": null
      },
      {
        "name": "Authentication Result",
        "type": "flow",
        "description": "Session token or authentication success/failure message.",
        "source": "Web Application",
        "destination": "User",
        "position": null
      },
      {
        "name": "Photo Upload Request",
        "type": "flow",
        "description": "User requests to upload a photo file (multipart form data).",
        "source": "User",
        "destination": "Web Application",
        "position": null
      },
      {
        "name": "Upload Result",
        "type": "flow",
        "description": "Success or failure confirmation of the upload.",
        "source": "Web Application",
        "destination": "User",
        "position": null
      },
      {
        "name": "Photo Retrieval Request",
        "type": "flow",
        "description": "User requests to view or download a photo.",
        "source": "User",
        "destination": "Web Application",
        "position": null
      },
      {
        "name": "Photo Data",
        "type": "flow",
        "description": "The requested image file is sent to the user.",
        "source": "Web Application",
        "destination": "User",
        "position": null
      },

      // Flows between Web Application and Data Stores
      {
        "name": "Query Credentials",
        "type": "flow",
        "description": "Application queries the DB to validate user login.",
        "source": "Web Application",
        "destination": "User Database",
        "position": null
      },
      {
        "name": "Query Results",
        "type": "flow",
        "description": "Database returns the user record (hashed PW, profile data).",
        "source": "User Database",
        "destination": "Web Application",
        "position": null
      },
      {
        "name": "Store Photo Metadata",
        "type": "flow",
        "description": "Application saves photo title, description, owner, location, etc.",
        "source": "Web Application",
        "destination": "User Database",
        "position": null
      },
      {
        "name": "Write Image File",
        "type": "flow",
        "description": "Application saves the uploaded image bytes to persistent storage.",
        "source": "Web Application",
        "destination": "Photo Storage",
        "position": null
      },
      {
        "name": "Read Image File",
        "type": "flow",
        "description": "Application retrieves the image bytes from storage to serve to the user.",
        "source": "Photo Storage",
        "destination": "Web Application",
        "position": null
      },
      {
        "name": "Query Photo Metadata",
        "type": "flow",
        "description": "Application queries for the user's photos and their data to display in the gallery.",
        "source": "Web Application",
        "destination": "User Database",
        "position": null
      },

      // Out-of-Scope Flow (for context)
      {
        "name": "Billing Webhook",
        "type": "flow",
        "description": "Out of Scope: Notification of successful payment.",
        "source": "Payment Processor",
        "destination": "Web Application",
        "position": null
      }
    ]
  }
}
